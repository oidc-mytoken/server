(function(l){"use strict";var a,u=u||(a={},{add:function(e,t){var r;if("object"==typeof e)for(r=0;r<e.length;r++){var n=e[r];a[n]||(a[n]=[]),a[n].push(t)}else a[e]||(a[e]=[]),a[e].push(t)},get:function(e){if(a[e])return a[e]}}),e=e||function(e){"function"!=typeof String.prototype.repeat&&(String.prototype.repeat=function(e){if(e<1)return"";if(e%2)return this.repeat(e-1)+this;var t=this.repeat(e/2);return t+t}),"function"!=typeof Array.prototype.filter&&(Array.prototype.filter=function(e){if(null===this)throw new TypeError;var t=Object(this),r=t.length>>>0;if("function"!=typeof e)throw new TypeError;for(var n=[],a=arguments[1],o=0;o<r;o++)if(o in t){var i=t[o];e.call(a,i,o,t)&&n.push(i)}return n});var p,g,t,c={textarea:null,replaceTab:!0,softTabs:!0,tabSize:4,autoOpen:!0,overwrite:!0,autoStrip:!0,autoIndent:!0,fence:!1},v={keyMap:[{open:'"',close:'"',canBreak:!1},{open:"'",close:"'",canBreak:!1},{open:"(",close:")",canBreak:!1},{open:"[",close:"]",canBreak:!0},{open:"{",close:"}",canBreak:!0}]},h={_callHook:function(e,t){var r=u.get(e);if(t="boolean"!=typeof t||!1!==t,r)if(t){var n,a=c.textarea,o=a.value,i=h.cursor.get();for(n=0;n<r.length;n++)r[n].call(l,{editor:{element:a,text:o,levelsDeep:h.levelsDeep()},caret:{pos:i},lines:{current:h.cursor.getLine(o,i),total:h.editor.getLines(o)}})}else for(n=0;n<r.length;n++)r[n].call(l)},defineNewLine:function(){var e=document.createElement("textarea");e.value="\n",g=2==e.value.length?"\r\n":"\n"},defineTabSize:function(e){void 0===c.textarea.style.OTabSize?void 0===c.textarea.style.MozTabSize?void 0===c.textarea.style.tabSize||(c.textarea.style.tabSize=e):c.textarea.style.MozTabSize=e:c.textarea.style.OTabSize=e},cursor:{getLine:function(e,t){return e.substring(0,t).split("\n").length},get:function(){if("number"==typeof document.createElement("textarea").selectionStart)return c.textarea.selectionStart;if(document.selection){var e=0,t=c.textarea.createTextRange(),r=document.selection.createRange().duplicate().getBookmark();for(t.moveToBookmark(r);0!==t.moveStart("character",-1);)e++;return e}},set:function(e,t){if(t=t||e,c.textarea.setSelectionRange)c.textarea.focus(),c.textarea.setSelectionRange(e,t);else if(c.textarea.createTextRange){var r=c.textarea.createTextRange();r.collapse(!0),r.moveEnd("character",t),r.moveStart("character",e),r.select()}},selection:function(){var e,t,r,n,a,o=c.textarea,i=0,s=0;return"number"==typeof o.selectionStart&&"number"==typeof o.selectionEnd?(i=o.selectionStart,s=o.selectionEnd):(t=document.selection.createRange())&&t.parentElement()==o&&(n=(e=h.editor.get()).length,(r=o.createTextRange()).moveToBookmark(t.getBookmark()),(a=o.createTextRange()).collapse(!1),-1<r.compareEndPoints("StartToEnd",a)?i=s=n:(i=-r.moveStart("character",-n),i+=e.slice(0,i).split(g).length-1,-1<r.compareEndPoints("EndToEnd",a)?s=n:(s=-r.moveEnd("character",-n),s+=e.slice(0,s).split(g).length-1))),i!=s&&{start:i,end:s}}},editor:{getLines:function(e){return e.split("\n").length},get:function(){return c.textarea.value.replace(/\r/g,"")},set:function(e){c.textarea.value=e}},fenceRange:function(){if("string"!=typeof c.fence)return!0;for(var e=h.editor.get(),t=h.cursor.get(),r=0,n=e.indexOf(c.fence),a=0;0<=n&&(a++,!(t<n+r));)r+=n+c.fence.length,n=(e=e.substring(n+c.fence.length)).indexOf(c.fence);return r<t&&t<n+r&&a%2==0},isEven:function(e,t){return t%2},levelsDeep:function(){var e,t,r=h.cursor.get(),n=h.editor.get().substring(0,r),a=0;for(e=0;e<n.length;e++)for(t=0;t<v.keyMap.length;t++)v.keyMap[t].canBreak&&(v.keyMap[t].open==n.charAt(e)&&a++,v.keyMap[t].close==n.charAt(e)&&a--);var o=0,i=["'",'"'];for(e=0;e<v.keyMap.length;e++)if(v.keyMap[e].canBreak)for(t in i)o+=n.split(i[t]).filter(h.isEven).join("").split(v.keyMap[e].open).length-1;var s=a-o;return 0<=s?s:0},deepExtend:function(e,t){for(var r in t)t[r]&&t[r].constructor&&t[r].constructor===Object?(e[r]=e[r]||{},h.deepExtend(e[r],t[r])):e[r]=t[r];return e},addEvent:function(e,t,r){e.addEventListener?e.addEventListener(t,r,!1):e.attachEvent&&e.attachEvent("on"+t,r)},removeEvent:function(e,t,r){e.addEventListener?e.removeEventListener(t,r,!1):e.attachEvent&&e.detachEvent("on"+t,r)},preventDefaultEvent:function(e){e.preventDefault?e.preventDefault():e.returnValue=!1}},r=function(e){if(h.fenceRange()){if(9==e.keyCode){h.preventDefaultEvent(e);var t=!0;h._callHook("tab:before");var r=h.cursor.selection(),n=h.cursor.get(),a=h.editor.get();if(r){for(var o=r.start;o--;)if("\n"==a.charAt(o)){r.start=o+1;break}var i,s=a.substring(r.start,r.end),c=s.split("\n");if(e.shiftKey){for(i=0;i<c.length;i++)c[i].substring(0,p.length)==p&&(c[i]=c[i].substring(p.length));s=c.join("\n"),h.editor.set(a.substring(0,r.start)+s+a.substring(r.end)),h.cursor.set(r.start,r.start+s.length)}else{for(i in c)c[i]=p+c[i];s=c.join("\n"),h.editor.set(a.substring(0,r.start)+s+a.substring(r.end)),h.cursor.set(r.start,r.start+s.length)}}else{var l=a.substring(0,n),u=a.substring(n),f=l+p+u;e.shiftKey?a.substring(n-p.length,n)==p&&(f=a.substring(0,n-p.length)+u,h.editor.set(f),h.cursor.set(n-p.length)):(h.editor.set(f),h.cursor.set(n+p.length),t=!1)}h._callHook("tab:after")}return t}},n=function(e){if(h.fenceRange()&&13==e.keyCode){h.preventDefaultEvent(e),h._callHook("enter:before");var t,r,n=h.cursor.get(),a=h.editor.get(),o=a.substring(0,n),i=a.substring(n),s=o.charAt(o.length-1),c=i.charAt(0),l=h.levelsDeep(),u="",f="";if(l){for(;l--;)u+=p;for(t=(u=u).length+1,r=0;r<v.keyMap.length;r++)v.keyMap[r].open==s&&v.keyMap[r].close==c&&(f=g)}else t=1;var d=o+g+u+f+u.substring(0,u.length-p.length)+i;h.editor.set(d),h.cursor.set(n+t),h._callHook("enter:after")}},a=function(e){if(h.fenceRange()&&8==e.keyCode){h.preventDefaultEvent(e),h._callHook("delete:before");var t,r=h.cursor.get(),n=h.editor.get(),a=n.substring(0,r),o=n.substring(r),i=a.charAt(a.length-1),s=o.charAt(0);if(!1===h.cursor.selection()){for(t=0;t<v.keyMap.length;t++)if(v.keyMap[t].open==i&&v.keyMap[t].close==s){var c=n.substring(0,r-1)+n.substring(r+1);return h.editor.set(c),void h.cursor.set(r-1)}c=n.substring(0,r-1)+n.substring(r);h.editor.set(c),h.cursor.set(r-1)}else{var l=h.cursor.selection();c=n.substring(0,l.start)+n.substring(l.end);h.editor.set(c),h.cursor.set(r)}h._callHook("delete:after")}},o=function(e,t){h.preventDefaultEvent(t),h._callHook("openChar:before");var r=h.cursor.get(),n=h.editor.get(),a=n.substring(0,r),o=n.substring(r),i=a+e.open+e.close+o;c.textarea.value=i,h.cursor.set(r+1),h._callHook("openChar:after")},i=function(e,t){var r=h.cursor.get();return h.editor.get().substring(r,r+1)==e.close&&(h.preventDefaultEvent(t),h._callHook("closeChar:before"),h.cursor.set(h.cursor.get()+1),h._callHook("closeChar:after"),!0)},s={filter:function(e){if(h.fenceRange()){var t=e.which||e.keyCode;if(39!=t&&(40!=t||0!==e.which)){var r,n=String.fromCharCode(t);for(r=0;r<v.keyMap.length;r++){if(v.keyMap[r].close==n)!(c.overwrite&&i(v.keyMap[r],e))&&v.keyMap[r].open==n&&c.autoOpen&&o(v.keyMap[r],e);else v.keyMap[r].open==n&&c.autoOpen&&o(v.keyMap[r],e)}}}},listen:function(){c.replaceTab&&h.addEvent(c.textarea,"keydown",r),c.autoIndent&&h.addEvent(c.textarea,"keydown",n),c.autoStrip&&h.addEvent(c.textarea,"keydown",a),h.addEvent(c.textarea,"keypress",s.filter),h.addEvent(c.textarea,"keydown",function(){h._callHook("keydown")}),h.addEvent(c.textarea,"keyup",function(){h._callHook("keyup")})}};this.destroy=function(){h.removeEvent(c.textarea,"keydown",r),h.removeEvent(c.textarea,"keydown",n),h.removeEvent(c.textarea,"keydown",a),h.removeEvent(c.textarea,"keypress",s.filter)},(t=e).textarea&&(h._callHook("init:before",!1),h.deepExtend(c,t),h.defineNewLine(),c.softTabs?p=" ".repeat(c.tabSize):(p="\t",h.defineTabSize(c.tabSize)),s.listen(),h._callHook("init:after",!1))};"undefined"!=typeof module&&module.exports&&(module.exports=e),"undefined"==typeof ender&&(this.Behave=e,this.BehaveHooks=u),"function"==typeof define&&define.amd&&define("behave",[],function(){return e})}).call(this);
//# sourceMappingURL=behave.min.js.map